{% extends "base.html" %}

{% block title_block %} Update User Profile {% endblock %}
{% block content %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Poppins', Arial, sans-serif;
    }
    
    body {
        background-color: var(--background-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        width: 100%;
        overflow-x: hidden;
        padding: 20px 15px;
    }
    
    #main-content {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-grow: 1;
        margin: 0 auto;
        padding: 40px 15px;
    }
    
    .update-container {
        background-color: var(--secondary-color);
        border-radius: 18px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
       
        width: 680px;
        padding: 45px 50px;
        text-align: center;
        margin: auto;
        position: relative;
        overflow: hidden;
        margin-top: 80px;
    }
    
    .update-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 8px;
        background: linear-gradient(to right, var(--primary-color), #FF69B4);
        border-radius: 18px 18px 0 0;
    }
    
    .update-container h2 {
        color: var(--text-color);
        margin-bottom: 25px;
        font-size: 28px;
        font-weight: 600;
    }
    
    .form-group {
        margin-bottom: 20px;
        position: relative;
        text-align: left;
    }
    
    .form-group label {
        font-size: 16px;
        font-weight: 500;
        color: var(--text-color);
        margin-bottom: 8px;
        display: block;
    }
    
    .form-group input,
    .form-group select {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e1e1e1;
        border-radius: 10px;
        font-size: 16px;
        background-color: white;
        transition: all 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 12px rgba(255, 182, 193, 0.4);
    }
    
    .submit-btn {
        width: 100%;
        padding: 16px;
        background: linear-gradient(to right, var(--primary-color), #FF69B4);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 17px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 105, 180, 0.25);
    }
    
    .submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 18px rgba(255, 105, 180, 0.35);
    }
    
    .submit-btn:active {
        transform: translateY(0);
    }
    
    /* Responsive improvements */
    @media (max-width: 768px) {
        .update-container {
            padding: 35px 30px;
            margin: 20px auto;
        }
        
        #main-content {
            padding: 15px;
        }
    }
    
</style>
{% endblock %}

{% block main_block %}
<div id="main-content">
    <div class="update-container">
        <div class="profile-icon">
       
        <h2>Update Your Profile</h2>
        <form id="updateForm" action="{{ url_for('update') }}" method="POST">
            <div class="form-group">
                
                <label for="email"><span class="input-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                </span> Email Address</label>
                <div class="input-container">
                    <input type="email" id="email" name="email" value="{{ current_user.email }}" required>
                    
                </div>
                <div id="emailError" class="error-message">Please enter a valid email address</div>
            </div>

            <div class="form-group">
                <label for="mobile"><span class="input-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                    </svg>
                </span>Mobile Number</label>
                <div class="input-container">
                    <input type="tel" id="mobile" name="mobile" value="{{ current_user.mobile }}" required>
                    
                </div>
                <div id="mobileError" class="error-message">Please enter a valid 10-digit mobile number</div>
            </div>

            <div class="form-group">
                <label for="age"><span class="input-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/>
                    </svg>
                </span>Age</label>
                <div class="input-container">
                    <input type="number" id="age" name="age" value="{{ current_user.age }}" required min="13">
                    
                </div>
                <div id="ageError" class="error-message">You must be at least 13 years old</div>
            </div>

            <div class="form-group">
                <label for="gender">Gender</label>
                <select id="gender" name="gender" required>
                    <option value="male" {% if current_user.gender=='male' %}selected{% endif %}>Male</option>
                    <option value="female" {% if current_user.gender=='female' %}selected{% endif %}>Female</option>
                    <option value="other" {% if current_user.gender=='other' %}selected{% endif %}>Other</option>
                    <option value="prefer_not_to_say" {% if current_user.gender=='prefer_not_to_say' %}selected{% endif %}>Prefer Not to Say</option>
                </select>
                <div id="genderError" class="error-message">Please select your gender</div>
            </div>

            <button type="submit" class="submit-btn">Update Profile</button>
        </form>
        <a href="{{ url_for('profile') }}" class="back-link">‚Üê Back to Profile</a>
    </div>
</div>

<script>
    // Focus & blur effects for form fields
    const formInputs = document.querySelectorAll('.form-group input, .form-group select');
    
    formInputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.closest('.form-group').classList.add('focused');
        });
        
        input.addEventListener('blur', function() {
            if (this.value === '') {
                this.closest('.form-group').classList.remove('focused');
            }
        });
        
        // Initialize focused state for pre-filled fields
        if (input.value !== '') {
            input.closest('.form-group').classList.add('focused');
        }
    });
    
    // Form validation
    document.getElementById('updateForm').addEventListener('submit', function(event) {
        let isValid = true;
        
        // Email validation
        const email = document.getElementById('email');
        const emailError = document.getElementById('emailError');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email.value)) {
            emailError.classList.add('show');
            email.style.borderColor = '#DC143C';
            isValid = false;
        } else {
            emailError.classList.remove('show');
            email.style.borderColor = '#e1e1e1';
        }
        
        // Mobile validation
        const mobile = document.getElementById('mobile');
        const mobileError = document.getElementById('mobileError');
        const mobileRegex = /^[0-9]{10}$/;
        if (!mobileRegex.test(mobile.value)) {
            mobileError.classList.add('show');
            mobile.style.borderColor = '#DC143C';
            isValid = false;
        } else {
            mobileError.classList.remove('show');
            mobile.style.borderColor = '#e1e1e1';
        }
        
        // Age validation
        const age = document.getElementById('age');
        const ageError = document.getElementById('ageError');
        if (age.value < 13) {
            ageError.classList.add('show');
            age.style.borderColor = '#DC143C';
            isValid = false;
        } else {
            ageError.classList.remove('show');
            age.style.borderColor = '#e1e1e1';
        }
        
        // Gender validation
        const gender = document.getElementById('gender');
        const genderError = document.getElementById('genderError');
        if (gender.value === '') {
            genderError.classList.add('show');
            gender.style.borderColor = '#DC143C';
            isValid = false;
        } else {
            genderError.classList.remove('show');
            gender.style.borderColor = '#e1e1e1';
        }
        
        // Prevent form submission if validation fails
        if (!isValid) {
            event.preventDefault();
            
            // Scroll to the first error
            const firstError = document.querySelector('.error-message.show');
            if (firstError) {
                firstError.closest('.form-group').scrollIntoView({ behavior: 'smooth' });
            }
        } else {
            // Add a loading state to the button
            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.innerHTML = '<span>Updating...</span>';
            submitBtn.style.opacity = '0.8';
            submitBtn.disabled = true;
        }
    });
    
    // Real-time validation
    document.getElementById('email').addEventListener('input', function() {
        const emailError = document.getElementById('emailError');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        if (this.value && !emailRegex.test(this.value)) {
            emailError.classList.add('show');
            this.style.borderColor = '#DC143C';
        } else {
            emailError.classList.remove('show');
            this.style.borderColor = '#e1e1e1';
        }
    });
    
    document.getElementById('mobile').addEventListener('input', function() {
        const mobileError = document.getElementById('mobileError');
        const mobileRegex = /^[0-9]{10}$/;
        
        if (this.value && !mobileRegex.test(this.value)) {
            mobileError.classList.add('show');
            this.style.borderColor = '#DC143C';
        } else {
            mobileError.classList.remove('show');
            this.style.borderColor = '#e1e1e1';
        }
    });
    
    document.getElementById('age').addEventListener('input', function() {
        const ageError = document.getElementById('ageError');
        
        if (this.value && this.value < 13) {
            ageError.classList.add('show');
            this.style.borderColor = '#DC143C';
        } else {
            ageError.classList.remove('show');
            this.style.borderColor = '#e1e1e1';
        }
    });
</script>
{% endblock %}